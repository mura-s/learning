:imagesdir: images

== ハンズオン
=== 概要
商品詳細画面から、商品を注文して完了画面を表示するまで、ひととおり実装します。

=== 手順
. 商品詳細画面の表示
.. ShoppingApplicationクラスを実行して、ブラウザで http://localhost:8080/catalog/display-list にアクセスしましょう。商品一覧画面が表示されます。
.. 商品のリンクをクリックしてみましょう。「Whitelabel Error Page」が表示されます。これは、リクエストに対応するハンドラメソッドが存在しないからです。
.. ブラウザのアドレスバーに表示されたURLを参照しながら、適切なハンドラメソッドを作成しましょう。合わせて、商品詳細画面を表示するテンプレートファイルも作成してください。商品詳細画面のデザインは自由ですが、参考としては以下のようなイメージになります。
+
image::product-detail.png[,200]

. 入力チェック
.. ブラウザで http://localhost:8080/order/display-form にアクセスしましょう。注文フォーム画面が表示されます。何も入力せずに「注文内容を確認」ボタンを押してください。何も入力していないにもかかわらず注文確認画面が表示されてしまいます。これは、入力チェックの処理が行われていないからです。
.. 以下の入力チェックを行って、NGだった場合は元の入力画面に戻るようにしてください。OrderControllerクラスのvalidateInputメソッドと、OrderInputクラスの修正が必要です。テンプレートファイルのorderForm.htmlは修正しなくて大丈夫です。入力チェックのルールは以下とします。
+
|===
|項目|ルール

|名前|空でないこと
|住所|空でないこと
|電話番号|空でないこと。電話番号の書式になっていること。
|メールアドレス|空でないこと。メールアドレスの書式になっていること。
|===

. 「注文を確定」ボタンを追加
.. 注文確認画面には、「注文内容を変更」ボタンしか存在しません。「注文を確定」ボタンを追加して、注文処理が行われるようにしましょう。
... 注文確認画面のテンプレートファイルorderConfirmation.htmlにボタンを追加しましょう。
... OrderControllerクラスのcorrectInputメソッドとorderメソッドが上手く呼び分けられるようにアノテーションを記述しましょう。
+
[NOTE]
アプリケーションを再起動したら、もう一度　http://localhost:8080/order/display-form から操作しましょう。


=== オプション
. 例外のハンドリング
.. 注文の確定処理を３回行ってみてください。「Whitelabel Error Page」が表示されます。これは、注文しようとした商品の在庫が足りなくなったからです。裏では「StockShortageException」がスローされています。
.. 在庫が足りない場合は、在庫が足りない旨がわかる画面を表示しましょう。画面のデザインは自由ですが、参考としては以下のようなイメージになります。
+
image::stock-shortage.png[,300]





